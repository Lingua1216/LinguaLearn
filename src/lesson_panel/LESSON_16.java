/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package lesson_panel;

import com.raven.form.SessionManager;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import javax.swing.JButton;
import javax.swing.JFrame;

/**
 *
 * @author intsi
 */
public class LESSON_16 extends javax.swing.JPanel {

    /**
     * Creates new form LESSON_13
     */
    public LESSON_16() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jScrollPane1 = new javax.swing.JScrollPane();
        jTextArea1 = new javax.swing.JTextArea();
        takequiz = new javax.swing.JButton();

        jTextArea1.setColumns(20);
        jTextArea1.setFont(new java.awt.Font("Serif", 0, 14)); // NOI18N
        jTextArea1.setRows(5);
        jTextArea1.setText("What is Japanese?\n\nJapanese (日本語, Nihongo) is the official language of Japan and is spoken by approximately 125 million people worldwide.\n It is a unique language with no direct relation to Chinese or Korean, though it has borrowed many Chinese characters (kanji) and vocabulary over centuries. Japanese is considered a member of the Japonic language family, \n which is not widely related to any other known languages, making it stand out linguistically.\nHistorically, Japanese began to take shape in the 8th century, and its written form evolved from the use of Chinese characters. \nThe hiragana and katakana scripts were developed over time to represent the phonetic aspects of the language, with kanji used for more complex, often borrowed, concepts.\nThe language is widely spoken in Japan, where it is the native tongue of virtually the entire population.\n Japanese is also spoken by expatriate communities around the world, particularly in countries like Brazil, the United States and Peru, which have significant numbers of Japanese descendants. \nWhile the language is not widely spoken outside Japan, it is increasingly learned as a foreign language due to Japan’s cultural influence in technology, business, and entertainment. \nWithin Japan, various regional dialects exist, each with its unique pronunciation, vocabulary, and sometimes even grammar. \nFor instance, the Kansai dialect(spoken in Osaka, Kyoto, and Kobe) differs notably from the Tokyo dialect in both tone and expression.\n However, Standard Japanese, based on the Tokyo dialect, is the dominant form used in media, education, and government. \nJapanese is known for its complex system of honorifics, where the language’s formality and politeness levels change depending on the social context, the relationship between speakers, and the subject of discussion.\n It also uses a rich writing system that combines hiragana,katakana, and kanji, each serving distinct roles. \nThough Japanese can be challenging for learners, especially due to its writing system and levels of politeness,\n it remains a fascinating and rewarding language to study, especially for those interested in Japan’s rich culture, history, and technological advancements.\n\n\n nihongo to wa ?\n\nnihongo ( nihongo 、 nihongo ) wa nihon no kouyougo de ari 、 sekaiju de yaku 1oku2,500man hito ga hanashi te i masu .chuugoku wa 、\n chuugoku go ya kankoku go to wa chokusetsu kankei no nai dokuji no gengo desu ga 、 nani seiki ni mo watatsu te ooku no kanji ( kanji ) ya goi wa shakuyou shi te ki mashi ta .nihongo wa 、\n hoka no kichi no gengo to hiroku kanren shi te i nai nichi ryu go zoku no 1in to minasa re te ori 、 gengo teki ni kiwadatsu te i masu . rekishi teki ni 、 nihongo wa 8 seiki ni katachizukura re hajime 、\n sono kakikotoba wa kanji no shiyou kara hatten shi mashi ta .hiraga na to katakana no moji wa 、 gengo no onsei teki sokumen wa arawasu tame ni jikan wa kake te kaihatsu sa re 、\n kanji wa yori fukuzatsu de 、 shibashiba shakuyou sa re ta gainen ni shiyou sa re mashi ta . kono gengo wa nihon de hiroku hanasa re te ori 、 jijitsu ue zen hitoguchi no bokoku go to natsu te i masu .nihongo wa 、\n sekaiju no chuuzai in community 、 tokuni brazil 、 beikoku nado no kuniodoriji de mo hanasa re te i masu peru ni wa kanari no suu no nikkei hito ga i masu .kono gengo wa nihon kokugai de hiroku hanasa re te i mase n ga 、\n technology 、 business 、 entertainment niokeru nihon no bunka teki eikyou niyori 、 gaikoku go toshite masumasu gakushuu sa re te i masu .nihon kokunai ni wa samazama na chiiki no hougen ga sonzai shi 、 sorezore ni dokuji no hatsuon 、 goi 、 tokiniha bunpou sae ari masu .tatoeba 、\n kansai hougen ( osaka 、 kyoto 、 koube de hanasa re te iru hougen ) wa 、 toukyou hougen to wa seichou ya hyougen ga ichijirushiku kotonari masu .shikashi 、 toukyou hougen ni motozuku hyoujun nihongo wa 、 media 、 kyoiku 、 seifu de shiyou sa reru shuyou na keishiki desu .nihongo wa 、\n shakai teki bunmyaku 、 hanashite ma no kankei 、 giron no shudai niyotte gengo no keishiki shou to reigi tadashi sa no level ga henka suru 、 fukuzatsu na keigo taikei de shira re te i masu .mata 、 hiraga na 、 katakana 、 kanji wa kumiawase ta yutaka na shoki taikei wa shiyou shi te ori 、\n sorezore ga kotonaru yakuwari wa hatashi te i masu . nihongo wa 、 tokuni sono shoki taikei ya reigi tadashi sa no level kara 、\n gakushuu mono nitotte wa muzukashii mono desu ga 、 tokuni nihon no yutaka na bunka 、 rekishi 、 gijutsu no shinpo ni kyoumi no aru hito nitotte wa 、 miryoku teki de yarigai no aru gengo de aru koto ni kawari wa ari mase n .");
        jScrollPane1.setViewportView(jTextArea1);

        takequiz.setText("Take Quiz");
        takequiz.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                takequizActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(738, 738, 738)
                .addComponent(takequiz, javax.swing.GroupLayout.PREFERRED_SIZE, 150, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(962, Short.MAX_VALUE))
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(layout.createSequentialGroup()
                    .addGap(0, 0, Short.MAX_VALUE)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 1850, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGap(0, 0, Short.MAX_VALUE)))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap(512, Short.MAX_VALUE)
                .addComponent(takequiz, javax.swing.GroupLayout.PREFERRED_SIZE, 60, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(128, 128, 128))
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(layout.createSequentialGroup()
                    .addGap(0, 0, Short.MAX_VALUE)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 700, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGap(0, 0, Short.MAX_VALUE)))
        );
    }// </editor-fold>//GEN-END:initComponents
    public void loginUser(int userId) {
    SessionManager.setSessionValue("userId", userId);  // Use "userId" to store the session
    System.out.println("User ID set in session: " + userId);
}

private boolean hasUserTakenQuiz(int quizId) {
    Integer userId = (Integer) SessionManager.getSessionValue("userId");  // Use "userId"
    if (userId == null) {
        javax.swing.JOptionPane.showMessageDialog(this, "Please log in to take the quiz.", "Error", javax.swing.JOptionPane.ERROR_MESSAGE);
        return true; // Prevent quiz if not logged in
    }

    String query = "SELECT COUNT(*) FROM responses WHERE user_id = ? AND quiz_id = ?";
    try (Connection conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/users-database", "root", "");
         PreparedStatement stmt = conn.prepareStatement(query)) {

        stmt.setInt(1, userId);
        stmt.setInt(2, quizId);
        ResultSet rs = stmt.executeQuery();

        if (rs.next() && rs.getInt(1) > 0) {
            javax.swing.JOptionPane.showMessageDialog(this, "You have already taken this quiz.", "Error", javax.swing.JOptionPane.ERROR_MESSAGE);
            return true; // User has already taken the quiz
        }

    } catch (SQLException e) {
        e.printStackTrace();
        javax.swing.JOptionPane.showMessageDialog(this, "Database error: " + e.getMessage(), "Error", javax.swing.JOptionPane.ERROR_MESSAGE);
    }
    return false; // User can take the quiz
}
    public static void main(String[] args) {
      
        // Create a JFrame
        JFrame frame = new JFrame();

        // Set the frame undecorated
        frame.setUndecorated(true);

        // Add the LESSON_13 JPanel to the frame
        LESSON_16 lessonPanel = new LESSON_16();
        frame.add(lessonPanel);

        // Set frame size and location
        frame.setSize(1200, 800); // Make the frame larger
        frame.setLocationRelativeTo(null); // Center the frame on the screen

        // Add a close button (optional, since no title bar is available)
        JButton closeButton = new JButton("Close");
        closeButton.setBounds(1100, 10, 80, 30); // Position it near the top-right
        lessonPanel.setLayout(null); // Use null layout for custom positioning
        lessonPanel.add(closeButton);

        closeButton.addActionListener(e -> System.exit(0)); // Close the application

        // Set frame visibility
        frame.setVisible(true);

        // Ensure the application exits when the frame is closed
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    }
    private void takequizActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_takequizActionPerformed
    // Check if the user is logged in by verifying the session for a valid userId
    Integer userId = (Integer) SessionManager.getSessionValue("userId");

    System.out.println("Logged in user ID: " + userId);  // Debug print

    if (userId == null) {
        // If user_id is not set, show a message asking the user to log in
        javax.swing.JOptionPane.showMessageDialog(this, "Please log in to take the quiz.", "Error", javax.swing.JOptionPane.ERROR_MESSAGE);
        return; // Exit the method if the user is not logged in
    }

    int quizId = 6; // Assume this is the quiz ID

    if (hasUserTakenQuiz(quizId)) {
        // If the user has already taken the quiz, exit the method
        return;
    }

    // Open quiz window
    Quiz_16 quizFrame = new Quiz_16(quizId);
    quizFrame.setVisible(true);
    quizFrame.pack();
    quizFrame.setLocationRelativeTo(null);

    // Dispose of current frame
    JFrame parentFrame = (JFrame) javax.swing.SwingUtilities.getWindowAncestor(this);
    if (parentFrame != null) {
        parentFrame.dispose();
    }
    }//GEN-LAST:event_takequizActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTextArea jTextArea1;
    private javax.swing.JButton takequiz;
    // End of variables declaration//GEN-END:variables

    private void dispose() {
        throw new UnsupportedOperationException("Not supported yet."); // Generated from nbfs://nbhost/SystemFileSystem/Templates/Classes/Code/GeneratedMethodBody
    }

    private void pack() {
        throw new UnsupportedOperationException("Not supported yet."); // Generated from nbfs://nbhost/SystemFileSystem/Templates/Classes/Code/GeneratedMethodBody
    }

    private void setLocationRelativeTo(Object object) {
        throw new UnsupportedOperationException("Not supported yet."); // Generated from nbfs://nbhost/SystemFileSystem/Templates/Classes/Code/GeneratedMethodBody
    }
}
